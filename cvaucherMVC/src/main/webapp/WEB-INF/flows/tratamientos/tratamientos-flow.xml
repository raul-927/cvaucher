<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/webflow
        http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">
        
     <!-- Inicio Variables paciente, direccion, agenda, historiaClinica, tratamientoPaciente -->
	 <on-start>
		<set name="flowScope.pacientes"
			value="new uy.com.cvaucher.services.domain.Pacientes()"
			type="uy.com.cvaucher.services.domain.Pacientes" />

		<set name ="flowScope.tratamientoPaciente"
			value ="new uy.com.cvaucher.services.domain.TratamientoPaciente()"
			type ="uy.com.cvaucher.services.domain.TratamientoPaciente"/>
			
		<set name ="flowScope.tratamiento"
			value =" new uy.com.cvaucher.services.domain.Tratamiento()"
			type ="uy.com.cvaucher.services.domain.Tratamiento"/>
			
		<set name ="flowScope.formPagosOptions"
			value ="new uy.com.cvaucher.services.clases.FormPagosOptions()"
			type ="uy.com.cvaucher.services.clases.FormPagosOptions"/>
				
	 </on-start>
	 	
	<!-- Cargo Pacientes en Tratamientos -->
	<action-state id="cargoPacientesEnTratamientos">
	
		 <evaluate expression="flowScope.tratamientoPaciente.pacientes = flowPacientesController.returnPacientes()"/>
		<transition to ="tratamientoPacienteInsert"/>
	</action-state>
	
	<!-- Tratamientos -->
	<view-state id="tratamientoPacienteInsert" view ="tratamientoPaciente/insertTratamientoPaciente" model ="tratamientoPaciente">
		<on-render>
			<evaluate result ="viewScope.salida" expression ="flowPacientesController.getFecha()"/>
			<evaluate result ="viewScope.tratP" expression="flowPacientesController.findAllTratamientoByActualList()"/>
		</on-render>
		
		<transition on ="cantSesionesTratamiento" to ="tratamientoPacienteInsert">
			
			<evaluate result ="flowScope.tratPacById" expression ="flowPacientesController.findTratamientoByActualListById(requestParameters.tratamId)"/>
			<render fragments="showCantSes"/>
		</transition>
		
		<transition on ="tratamientoPacienteIngresado" to ="seleccionoFormaDePago" bind="true">
			 <evaluate expression="flowPacientesController.insertTratamientoPaciente(flowScope.tratamientoPaciente)"/>
		</transition>
	</view-state>
	
	<view-state id ="seleccionoFormaDePago" view ="tratamientoPaciente/seleccionoFormaPago" model ="formPagosOptions">
		<on-render>
			<evaluate result ="viewScope.fpagoOption" expression="flowPacientesController.findAllFormasDePagos()"/>
		</on-render>
		<transition on = "FormaPagoSelect" to ="decisionFormaPago"/>		
	
	</view-state>
	
	<decision-state id="decisionFormaPago">
		<if test="flowScope.formPagosOptions.formaDePago == TC" then="pagoTarjetaCredito"/>
		<if test="flowScope.formaPagosOptions.formaDePago == EF" then="pagoEfectivo"/>
		<if test="flowScope.formaPagosOptions.formaDePago == CE" then="pagoCreditoEfectivo"/>
		<if test="flowScope.formaPagosOptions.formaDePago == DP" then="pagoDepositoBancario"/>
	</decision-state>
	
	<view-state id="pagoTarjetaCredito" view ="" model ="">
		
	
	</view-state>
	<end-state id="finIngresoPacientes"/>
	
</flow>