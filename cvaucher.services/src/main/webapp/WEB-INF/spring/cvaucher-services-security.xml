<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:context = "http://www.springframework.org/schema/context"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	http://www.springframework.org/schema/security 
	http://www.springframework.org/schema/security/spring-security-3.1.xsd
	http://www.springframework.org/schema/context
	http://www.springframework.org/schema/context/spring-context-3.1.xsd">
	
    <context:component-scan base-package="uy.com.cvaucher.services" />
    
	<security:global-method-security
		secured-annotations="enabled">
		<!-- <security:protect-pointcut access="ROLE_ADMIN"
			expression="execution(* com.apress.pss.terrormovies.service.MoviesService.*(..))" /> -->
	</security:global-method-security>

	<security:http auto-config="true" />

	<security:authentication-manager>
		<security:authentication-provider
				user-service-ref="inMemoryUserServiceWithCustomUser" />
		   <!-- <security:jdbc-user-service data-source-ref="dataSource"
		  		
		  		users-by-username-query = "SELECT dom_usr_nic, dom_usr_pass, dom_usr_enabled 
		  								   FROM domain_user 
		  								   WHERE dom_usr_nic = ? 
		  								   AND dom_usr_enabled = 1"
		  		
		  		authorities-by-username-query =	"SELECT d.dom_usr_nic, r.rol_name 
												 FROM domain_user d, roles r, nic_roles n 
												 WHERE d.dom_usr_nic = ?
												 AND d.dom_usr_id = n.nic_rol_user_nic_id 
												 AND n.nic_rol_name_id = r.rol_id" />
		</security:authentication-provider>-->
	</security:authentication-manager>

	<bean id="expressionHandler"
		class="uy.com.cvaucher.services.security.CustomWebSecurityExpressionHandler" />
	
	<bean id="inMemoryUserServiceWithCustomUser"
		class="uy.com.cvaucher.services.security.CustomInMemoryUserDetailsManager">
		<constructor-arg>
			<list>
				<bean class="uy.com.cvaucher.services.security.User">
					<constructor-arg value="admin" />
					<constructor-arg value="admin" />
					<constructor-arg>
						<list>
							<bean
								class="org.springframework.security.core.authority.SimpleGrantedAuthority">
								<constructor-arg value="ROLE_ADMIN" />
							</bean>
						</list>
					</constructor-arg>
					<constructor-arg value="raul2" />
					<constructor-arg value="19" />
				</bean>
				<bean class="uy.com.cvaucher.services.security.User">
					<constructor-arg value="raul" />
					<constructor-arg value="rulo" />
					<constructor-arg>
						<list>
							<bean
								class="org.springframework.security.core.authority.SimpleGrantedAuthority">
								<constructor-arg value="ROLE_USER" />
							</bean>
						</list>
					</constructor-arg>
					<constructor-arg value="Miranda" />
					<constructor-arg value="20" />
				</bean>
				<bean class="uy.com.cvaucher.services.security.User">
					<constructor-arg value="lucas" />
					<constructor-arg value="fernandez" />
					<constructor-arg>
						<list>
							<bean
								class="org.springframework.security.core.authority.SimpleGrantedAuthority">
								<constructor-arg value="ROLE_VIP" />
							</bean>
							<bean
								class="org.springframework.security.core.authority.SimpleGrantedAuthority">
								<constructor-arg value="ROLE_USER" />
							</bean>
						</list>
					</constructor-arg>
					<constructor-arg value="Silva" />
					<constructor-arg value="20" />
				</bean>
			</list>
		</constructor-arg>
	</bean>
	
	<!--<bean id="moviesService" class="com.apress.pss.terrormovies.service.MoviesServiceImpl">
		<security:intercept-methods>
			<security:protect
				method="com.apress.pss.terrormovies.service.MoviesService.*"
				access="ROLE_ADMIN" />
		</security:intercept-methods>
	</bean>-->
</beans>
